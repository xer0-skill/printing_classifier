function windowItem(b,a){this.element=a;this.zIndex=function(c){if(c!=null){this.element.style.zIndex=c;}else{return parseInt(this.element.style.zIndex);}};this.opened=function(){return !($(this.element).hasClass("farAway"));};this.params={closeCallback:null,onOpen:null,onAjaxLoad:null};this.height=0;this.width=0;this.zIndex(b);this.tinted=false;}function Windows(){this.MIN_Z_INDEX=30;this.window={};this.active=null;this.eventInterval=0;this.isInit=false;this.globalWorkSpace=false;this.ajaxDataLoaded=false;this.scroll=function(){if(this.active==null){return;}this.align();};this.resizeEventCheck=function(){var b=this.active;if(b==null){clearInterval(this.eventInterval);return;}var a=this.window[b.id];if(a.width==b.offsetWidth&&a.height==b.offsetHeight){return;}a.width=b.offsetWidth;a.height=b.offsetHeight;this.onresize();};this.loadAjaxData=function(d,b,c){if(this.ajaxDataLoaded){return;}this.ajaxDataLoaded=true;var a=this;ajaxQuery(null,b,function(g){var e=$("#"+d);$(e).empty();if(trim(g)==""){a.ajaxDataLoaded=false;return;}$(e).append($(g));var f=a.window[d+"Win"];if(f!=null&&f.params.onAjaxLoad!=null){if(f.params.onAjaxLoad(d,g)==false){return;}}if(c!=null){c(d);}a.ajaxDataLoaded=false;});};this.tinedWindows=function(a){if(a&&this.active){clearTimeout(this.active.divFloat.floatTimer);}for(var b in this.window){if(this.window[b].opened()){var c=findChildByClassName(this.window[b].element,"r-content");TintedNet.setTinted(c,a);this.window[b].tinted=!a;}}};this.open=function(b,j,e){if(!this.isInit){return;}var h=this.window[b+"Win"];if(h==undefined||h.element==undefined){alert('Окно с ID "'+b+'" отсутствует');return;}var f=h.element;if(this.active==f){return;}if(this.active!=null){var c=this.active.className.split(" ");var a=f.className.split(" ");for(var g in c){if(c[g]!="window"&&c[g]!=e){if(a.contains(c[g])){this.close(this.active);break;}}}}if(h.params.onOpen!=null&&j!=true){if(h.params.onOpen(b)==false){return;}}this.active=f;var l=this;var m=this.MIN_Z_INDEX;for(var d in this.window){if(this.window[d].zIndex()>m&&this.window[d].opened()){m=this.window[d].zIndex();}}$(f).removeClass("farAway");this.positioning(f);h.zIndex(m+11);h.width=f.offsetWidth;h.height=f.offsetWidth;this.eventInterval=setInterval(function(){l.resizeEventCheck();},200);setTintedDiv(true,this.globalWorkSpace);};this.openClosable=function(c,b,a){this.open(c,b,a);$(document).click(function(f){var d=$(f.target);if(d.closest("#"+c+"Win").length==0){win.close(c);}});};this.close=function(f){var d;if(typeof(f)=="string"){d=this.window[f+"Win"];}else{var a=findParentByClassName(f,"window");if(a==document){alert("Родительское окно не найдено.");return;}d=this.window[a.id];}if(d==undefined){alert('Окно с ID "'+f+'" отсутствует');return;}if(d.params.closeCallback!=null&&!d.params.closeCallback()){return;}var c=d.element;c.style.zIndex=c.style.zIndex-1;$(c).css("left","");$(c).addClass("farAway");var e=0;this.active=null;for(var b in this.window){if(this.window[b].zIndex()>e&&this.window[b].opened()){e=this.window[b].zIndex();this.active=this.window[b].element;}}if(this.active==null){setTintedDiv(false,this.globalWorkSpace);clearInterval(this.eventInterval);}};this.init=function(b){var d=getWorkSpace(this.globalWorkSpace);var e=findChildsByClassName(b,"window");var a=this;for(var c=0;c<e.length;c++){if((e[c].id)==""||e[c].id==null){continue;}var f=$(d).children("#"+e[c].id).get(0);if(f!=null&&f!==e[c]){$(f).replaceWith(e[c]);}else{if(d){d.appendChild(e[c]);}}this.window[e[c].id]=new windowItem(this.MIN_Z_INDEX,e[c]);e[c].divFloat=new DivFloat(e[c]);}addSwitchableEvent(window,"scroll",function(){a.scroll();},"modalWindowScrollEvent");this.isInit=true;};this.setGlobalWorkSpace=function(c,b){var a=getWorkSpace(this.globalWorkSpace);this.globalWorkSpace=c;var e=getWorkSpace(c);var f=findChildsByClassName(a,"window");for(var d=0;d<f.length;d++){if((f[d].id)==""||f[d].id==null){continue;}var g=b.getElementById(f[d].id);a.removeChild(f[d]);e.appendChild(f[d]);}};this.positioning=function(e){var b=getWorkSpace(this.globalWorkSpace);var a=e.offsetWidth;var d=b.offsetWidth/2-a/2;var c=screenSize();e.style.marginLeft=d+"px";if(c.h<e.offsetHeight){e.style.top=getScrollTop()+"px";}else{e.style.top=workCenter(e).topCenter-e.offsetHeight/2+"px";}};this.align=function(){if(isMobileDevice()){return;}var f=this.active;clearTimeout(f.divFloat.floatTimer);var b=screenSize();var a=f.offsetHeight;var e=0;var d=workCenter(f,this.globalWorkSpace);var g=Math.round(d.topCenter-a/2);if(f.style.top!=""){e=parseInt(f.style.top);}if(g<d.abs.top/2){g=Math.round(d.abs.top/2);}if(b.h<a){var c=b.h/10;if(e<g){g=(b.h+$(document).scrollTop())-c-a;if(g<e){return;}}else{if(g<e&&g<$(document).scrollTop()){g=$(document).scrollTop()+c;}if(g>e){return;}}}f.divFloat.floatEffect(e,g);};this.onresize=function(){this.align();};this.aditionalData=function(c,b){if(this.window[c+"Win"]==undefined){return;}for(var a in b){if(a in this.window[c+"Win"].params){this.window[c+"Win"].params[a]=b[a];}}};
this.getWinItem=function(a){return this.window[a+"Win"];};this.getCurrentWinItem=function(){var c=0;var b=null;for(var a in this.window){if(this.window[a].opened()&&this.window[a].zIndex()>c){c=this.window[a].zIndex();b=this.window[a];}}return b;};}var win=new Windows();$(document).ready(function(){win.init(document);});